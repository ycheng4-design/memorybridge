     1→// Database types - supports both old and new schema
     2→export interface Session {
     3→  id: string;
     4→  user_id: string;
     5→  // Old schema
     6→  mode?: string;
     7→  started_at?: string;
     8→  ended_at?: string | null;
     9→  score_summary?: ScoreSummary;
    10→  // New schema (from supabase-migration-v2)
    11→  type?: 'analytics' | 'practice' | 'strategy';
    12→  created_at: string;
    13→  video_path?: string;
    14→  video_url?: string;
    15→  filename?: string;
    16→  duration_seconds?: number;
    17→  overall_score?: number;
    18→  summary?: ScoreSummary;
    19→  pose_data?: any[];
    20→  frame_count?: number;
    21→  // v3 enhanced schema
    22→  status?: 'processing' | 'ready' | 'error';
    23→  match_format?: 'singles' | 'doubles';
    24→  event_type?: 'MS' | 'WS' | 'MD' | 'WD' | 'XD';
    25→  selected_tracks?: number[];
    26→  summary_score?: number;
    27→  skill_level?: 'beginner' | 'intermediate' | 'advanced';
    28→  rules_version?: string;
    29→  tracks_data?: PlayerTrackData[];
    30→  // Practice recording fields (v4)
    31→  practice_video_path?: string;
    32→  practice_video_mime?: string;
    33→  practice_video_duration_sec?: number;
    34→  practice_video_size_bytes?: number;
    35→}
    36→
    37→export interface ScoreSummary {
    38→  green_count?: number;
    39→  green_frames?: number;
    40→  red_count?: number;
    41→  red_frames?: number;
    42→  total_frames: number;
    43→  average_score?: number;
    44→  green_ratio?: number;
    45→  drill_id?: string;
    46→  drill_type?: string;
    47→  metrics_avg?: PoseMetrics;
    48→  shot_count?: number;
    49→  error_count?: number;
    50→  feedback?: any;
    51→}
    52→
    53→export interface AnalysisResult {
    54→  id: string;
    55→  user_id: string;
    56→  video_path: string;
    57→  result_json: AnalysisResultJson | null;
    58→  status: 'processing' | 'completed' | 'error';
    59→  created_at: string;
    60→}
    61→
    62→export interface AnalysisResultJson {
    63→  top_issues: Issue[];
    64→  drills: Drill[];
    65→  technique_summary: string;
    66→  strategy_summary: string;
    67→  training_plan: TrainingPlanItem[];
    68→  drill_visuals?: string[]; // URLs to generated drill images
    69→}
    70→
    71→export interface Issue {
    72→  id: string;
    73→  title: string;
    74→  severity: 'high' | 'medium' | 'low';
    75→  description: string;
    76→  affected_metrics: string[];
    77→}
    78→
    79→export interface Drill {
    80→  id: string;
    81→  name: string;
    82→  description: string;
    83→  duration_minutes: number;
    84→  target_metrics: string[];
    85→  instructions: string[];
    86→}
    87→
    88→export interface TrainingPlanItem {
    89→  day: number;
    90→  focus: string;
    91→  drills: string[];
    92→  duration_minutes: number;
    93→}
    94→
    95→export interface RacketFavorite {
    96→  id: string;
    97→  user_id: string;
    98→  racket_id: string;
    99→  created_at: string;
   100→}
   101→
   102→// Pose estimation types
   103→export interface PoseMetrics {
   104→  elbow_angle: number;
   105→  knee_angle: number;
   106→  stance_width_norm: number;
   107→  shoulder_hip_rotation_proxy: number;
   108→  timestamp?: number;
   109→}
   110→
   111→export interface PoseLandmark {
   112→  x: number;
   113→  y: number;
   114→  z: number;
   115→  visibility: number;
   116→}
   117→
   118→// API types
   119→export interface TickRequest {
   120→  metrics_snapshot: PoseMetrics;
   121→  drill_id?: string;
   122→  session_id?: string;
   123→}
   124→
   125→export interface TickResponse {
   126→  cue: string;
   127→  focus_metric: string;
   128→  green_thresholds: {
   129→    [key: string]: { min: number; max: number };
   130→  };
   131→  is_green: boolean;
   132→}
   133→
   134→export interface RacketRecommendRequest {
   135→  level: 'beginner' | 'intermediate' | 'advanced';
   136→  weaknesses: string[];
   137→  style_pref?: 'power' | 'control' | 'all-round';
   138→}
   139→
   140→export interface Racket {
   141→  id: string;
   142→  name: string;
   143→  brand: string;
   144→  price_band: 'budget' | 'mid-range' | 'premium';
   145→  price_range: string;
   146→  play_style: string[];
   147→  skill_level: string[];
   148→  weight: string;
   149→  balance: string;
   150→  flexibility: string;
   151→  description: string;
   152→  image_url: string;
   153→  ebay_search_query: string;
   154→}
   155→
   156→export interface RacketRecommendation extends Racket {
   157→  match_score: number;
   158→  match_reason: string;
   159→}
   160→
   161→// Chart data types
   162→export interface ChartDataPoint {
   163→  date: string;
   164→  score: number;
   165→  greenRatio?: number;
   166→  checkIns?: number;
   167→}
   168→
   169→// User profile
   170→export interface UserProfile {
   171→  id: string;
   172→  email: string;
   173→  created_at: string;
   174→}
   175→
   176→// ============================================
   177→// V3 Enhanced Types
   178→// ============================================
   179→
   180→// Session assets for persistent storage
   181→export interface SessionAsset {
   182→  id: string;
   183→  session_id: string;
   184→  kind: 'video' | 'analysis_json' | 'pose_json' | 'keyframe1' | 'keyframe2' | 'keyframe3' | 'trajectory_json' | 'trajectory_video' | 'tracks_thumbnail';
   185→  storage_path: string;
   186→  storage_bucket: string;
   187→  metadata?: Record<string, any>;
   188→  created_at: string;
   189→}
   190→
   191→// Player track data for multi-person tracking
   192→export interface PlayerTrackData {
   193→  track_id: number;
   194→  thumbnail_url?: string;
   195→  bbox_samples: BoundingBoxSample[];
   196→  side?: 'near' | 'far';
   197→  is_selected: boolean;
   198→  confidence_avg: number;
   199→  frame_count: number;
   200→}
   201→
   202→export interface BoundingBoxSample {
   203→  frame: number;
   204→  x: number;
   205→  y: number;
   206→  w: number;
   207→  h: number;
   208→  confidence?: number;
   209→}
   210→
   211→// Strategy mode types
   212→export interface StrategyResult {
   213→  id: string;
   214→  session_id: string;
   215→  original_trajectory: TrajectoryPoint[];
   216→  refined_trajectory: TrajectoryPoint[];
   217→  coaching_points: string[];
   218→  court_homography?: number[][];
   219→  shuttle_detections?: ShuttleDetection[];
   220→  created_at: string;
   221→}
   222→
   223→export interface TrajectoryPoint {
   224→  x: number;
   225→  y: number;
   226→  timestamp: number;
   227→  court_x?: number; // Court-mapped x coordinate (0-1)
   228→  court_y?: number; // Court-mapped y coordinate (0-1)
   229→}
   230→
   231→export interface ShuttleDetection {
   232→  frame: number;
   233→  x: number;
   234→  y: number;
   235→  confidence: number;
   236→}
   237→
   238→// Banded scoring types
   239→export type ScoreBand = 'green' | 'yellow' | 'red' | 'unknown';
   240→
   241→export interface BandedScore {
   242→  band: ScoreBand;
   243→  value: number;
   244→  confidence: number;
   245→  feedback?: string;
   246→}
   247→
   248→export interface ScoringRulesConfig {
   249→  version: string;
   250→  skill_bands: {
   251→    beginner: SkillBandConfig;
   252→    intermediate: SkillBandConfig;
   253→    advanced: SkillBandConfig;
   254→  };
   255→  confidence_threshold: number;
   256→  phase_rules: Record<string, PhaseRule>;
   257→}
   258→
   259→export interface SkillBandConfig {
   260→  green_tolerance: number; // Percentage wider than ideal
   261→  yellow_tolerance: number; // Percentage wider than green
   262→}
   263→
   264→export interface PhaseRule {
   265→  name: string;
   266→  applicable_metrics: string[];
   267→  thresholds: Record<string, { min: number; max: number }>;
   268→}
   269→
   270→// Multi-pose detection result
   271→export interface MultiPoseResult {
   272→  poses: DetectedPose[];
   273→  timestamp: number;
   274→}
   275→
   276→export interface DetectedPose {
   277→  track_id: number;
   278→  landmarks: PoseLandmark[];
   279→  bbox: { x: number; y: number; w: number; h: number };
   280→  confidence: number;
   281→}
   282→
   283→// Event type labels
   284→export const EVENT_TYPE_LABELS: Record<string, string> = {
   285→  MS: "Men's Singles",
   286→  WS: "Women's Singles",
   287→  MD: "Men's Doubles",
   288→  WD: "Women's Doubles",
   289→  XD: 'Mixed Doubles',
   290→};
   291→
   292→// 3D Skeleton animation types
   293→export interface SkeletonKeyframe {
   294→  label: string;
   295→  landmarks: { x: number; y: number; z: number }[];
   296→  timestamp: number;
   297→}
   298→
   299→export interface AnimatedDrill {
   300→  id: string;
   301→  name: string;
   302→  phases: DrillPhase[];
   303→  loop: boolean;
   304→  duration_ms: number;
   305→}
   306→
   307→export interface DrillPhase {
   308→  name: string;
   309→  keyframes: SkeletonKeyframe[];
   310→  duration_ms: number;
   311→}
   312→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
