     1â†’'use client';
     2â†’
     3â†’import { useState, useEffect } from 'react';
     4â†’import DashboardNav from '@/components/DashboardNav';
     5â†’import { supabase } from '@/lib/supabase';
     6â†’import type { RacketRecommendation } from '@/lib/types';
     7â†’
     8â†’const SKILL_LEVELS = [
     9â†’  { value: 'beginner', label: 'Beginner', description: 'New to badminton' },
    10â†’  { value: 'intermediate', label: 'Intermediate', description: '1-3 years experience' },
    11â†’  { value: 'advanced', label: 'Advanced', description: '3+ years, competitive play' },
    12â†’];
    13â†’
    14â†’const PLAY_STYLES = [
    15â†’  { value: 'power', label: 'Power', description: 'Strong smashes and clears' },
    16â†’  { value: 'control', label: 'Control', description: 'Precise placement and drops' },
    17â†’  { value: 'all-round', label: 'All-Round', description: 'Balanced gameplay' },
    18â†’];
    19â†’
    20â†’const WEAKNESSES = [
    21â†’  { value: 'smash_power', label: 'Smash Power' },
    22â†’  { value: 'defense', label: 'Defense' },
    23â†’  { value: 'footwork', label: 'Footwork' },
    24â†’  { value: 'net_play', label: 'Net Play' },
    25â†’  { value: 'endurance', label: 'Endurance' },
    26â†’  { value: 'consistency', label: 'Consistency' },
    27â†’];
    28â†’
    29â†’export default function RacketPage() {
    30â†’  const [level, setLevel] = useState<string>('intermediate');
    31â†’  const [style, setStyle] = useState<string>('all-round');
    32â†’  const [weaknesses, setWeaknesses] = useState<string[]>([]);
    33â†’  const [loading, setLoading] = useState(false);
    34â†’  const [recommendations, setRecommendations] = useState<RacketRecommendation[]>([]);
    35â†’  const [favorites, setFavorites] = useState<Set<string>>(new Set());
    36â†’  const [error, setError] = useState<string | null>(null);
    37â†’
    38â†’  useEffect(() => {
    39â†’    loadFavorites();
    40â†’  }, []);
    41â†’
    42â†’  const loadFavorites = async () => {
    43â†’    const { data: { user } } = await supabase.auth.getUser();
    44â†’    if (!user) return;
    45â†’
    46â†’    try {
    47â†’      const { data, error } = await supabase
    48â†’        .from('racket_favorites')
    49â†’        .select('racket_id')
    50â†’        .eq('user_id', user.id);
    51â†’
    52â†’      // Gracefully handle if table doesn't exist
    53â†’      if (error) {
    54â†’        console.log('Favorites not available:', error.message);
    55â†’        return;
    56â†’      }
    57â†’
    58â†’      if (data) {
    59â†’        setFavorites(new Set(data.map((f) => f.racket_id)));
    60â†’      }
    61â†’    } catch (err) {
    62â†’      // Table may not exist - just use local state
    63â†’      console.log('Using local favorites only');
    64â†’    }
    65â†’  };
    66â†’
    67â†’  const toggleWeakness = (weakness: string) => {
    68â†’    setWeaknesses((prev) =>
    69â†’      prev.includes(weakness)
    70â†’        ? prev.filter((w) => w !== weakness)
    71â†’        : [...prev, weakness]
    72â†’    );
    73â†’  };
    74â†’
    75â†’  const getRecommendations = async () => {
    76â†’    if (weaknesses.length === 0) {
    77â†’      setError('Please select at least one weakness to improve');
    78â†’      return;
    79â†’    }
    80â†’
    81â†’    setError(null);
    82â†’    setLoading(true);
    83â†’
    84â†’    try {
    85â†’      const response = await fetch('/api/racket/recommend', {
    86â†’        method: 'POST',
    87â†’        headers: { 'Content-Type': 'application/json' },
    88â†’        body: JSON.stringify({
    89â†’          level,
    90â†’          weaknesses,
    91â†’          style_pref: style,
    92â†’        }),
    93â†’      });
    94â†’
    95â†’      if (!response.ok) {
    96â†’        throw new Error('Failed to get recommendations');
    97â†’      }
    98â†’
    99â†’      const data = await response.json();
   100â†’      setRecommendations(data.recommendations);
   101â†’    } catch (err) {
   102â†’      console.error('Error:', err);
   103â†’      setError('Failed to get recommendations. Please try again.');
   104â†’    } finally {
   105â†’      setLoading(false);
   106â†’    }
   107â†’  };
   108â†’
   109â†’  const toggleFavorite = async (racketId: string) => {
   110â†’    // Always toggle locally first for immediate UI feedback
   111â†’    setFavorites((prev) => {
   112â†’      const next = new Set(prev);
   113â†’      if (next.has(racketId)) {
   114â†’        next.delete(racketId);
   115â†’      } else {
   116â†’        next.add(racketId);
   117â†’      }
   118â†’      return next;
   119â†’    });
   120â†’
   121â†’    // Try to persist to database if user is logged in
   122â†’    const { data: { user } } = await supabase.auth.getUser();
   123â†’    if (!user) return;
   124â†’
   125â†’    try {
   126â†’      if (favorites.has(racketId)) {
   127â†’        // Remove from favorites
   128â†’        await supabase
   129â†’          .from('racket_favorites')
   130â†’          .delete()
   131â†’          .eq('user_id', user.id)
   132â†’          .eq('racket_id', racketId);
   133â†’      } else {
   134â†’        // Add to favorites
   135â†’        await supabase.from('racket_favorites').insert({
   136â†’          user_id: user.id,
   137â†’          racket_id: racketId,
   138â†’        });
   139â†’      }
   140â†’    } catch (err) {
   141â†’      // Table may not exist - favorites are still stored locally
   142â†’      console.log('Favorites stored locally only');
   143â†’    }
   144â†’  };
   145â†’
   146â†’  const openEbaySearch = (query: string) => {
   147â†’    const url = `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(query)}`;
   148â†’    window.open(url, '_blank');
   149â†’  };
   150â†’
   151â†’  return (
   152â†’    <div className="min-h-screen bg-gray-50">
   153â†’      <DashboardNav />
   154â†’
   155â†’      <main className="ml-64 p-8">
   156â†’        <div className="max-w-7xl mx-auto">
   157â†’          {/* Header */}
   158â†’          <div className="mb-8">
   159â†’            <h1 className="text-3xl font-bold text-gray-900">Racket Finder</h1>
   160â†’            <p className="text-gray-600 mt-1">
   161â†’              Get personalized racket recommendations based on your playing profile
   162â†’            </p>
   163â†’          </div>
   164â†’
   165â†’          {/* Selection Form */}
   166â†’          <div className="bg-white rounded-xl p-6 shadow-sm mb-8">
   167â†’            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
   168â†’              {/* Skill Level */}
   169â†’              <div>
   170â†’                <h3 className="font-semibold text-gray-900 mb-3">Skill Level</h3>
   171â†’                <div className="space-y-2">
   172â†’                  {SKILL_LEVELS.map((lvl) => (
   173â†’                    <button
   174â†’                      key={lvl.value}
   175â†’                      onClick={() => setLevel(lvl.value)}
   176â†’                      className={`w-full text-left p-3 rounded-lg border transition ${
   177â†’                        level === lvl.value
   178â†’                          ? 'border-primary-500 bg-primary-50'
   179â†’                          : 'border-gray-200 hover:border-gray-300'
   180â†’                      }`}
   181â†’                    >
   182â†’                      <p className="font-medium text-gray-900">{lvl.label}</p>
   183â†’                      <p className="text-sm text-gray-500">{lvl.description}</p>
   184â†’                    </button>
   185â†’                  ))}
   186â†’                </div>
   187â†’              </div>
   188â†’
   189â†’              {/* Play Style */}
   190â†’              <div>
   191â†’                <h3 className="font-semibold text-gray-900 mb-3">Play Style</h3>
   192â†’                <div className="space-y-2">
   193â†’                  {PLAY_STYLES.map((s) => (
   194â†’                    <button
   195â†’                      key={s.value}
   196â†’                      onClick={() => setStyle(s.value)}
   197â†’                      className={`w-full text-left p-3 rounded-lg border transition ${
   198â†’                        style === s.value
   199â†’                          ? 'border-primary-500 bg-primary-50'
   200â†’                          : 'border-gray-200 hover:border-gray-300'
   201â†’                      }`}
   202â†’                    >
   203â†’                      <p className="font-medium text-gray-900">{s.label}</p>
   204â†’                      <p className="text-sm text-gray-500">{s.description}</p>
   205â†’                    </button>
   206â†’                  ))}
   207â†’                </div>
   208â†’              </div>
   209â†’
   210â†’              {/* Weaknesses */}
   211â†’              <div>
   212â†’                <h3 className="font-semibold text-gray-900 mb-3">
   213â†’                  Areas to Improve
   214â†’                </h3>
   215â†’                <div className="flex flex-wrap gap-2">
   216â†’                  {WEAKNESSES.map((w) => (
   217â†’                    <button
   218â†’                      key={w.value}
   219â†’                      onClick={() => toggleWeakness(w.value)}
   220â†’                      className={`px-3 py-2 rounded-lg border text-sm transition ${
   221â†’                        weaknesses.includes(w.value)
   222â†’                          ? 'border-primary-500 bg-primary-50 text-primary-700'
   223â†’                          : 'border-gray-200 text-gray-600 hover:border-gray-300'
   224â†’                      }`}
   225â†’                    >
   226â†’                      {w.label}
   227â†’                    </button>
   228â†’                  ))}
   229â†’                </div>
   230â†’                <p className="text-xs text-gray-500 mt-2">
   231â†’                  Select at least one area
   232â†’                </p>
   233â†’              </div>
   234â†’            </div>
   235â†’
   236â†’            {error && (
   237â†’              <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
   238â†’                {error}
   239â†’              </div>
   240â†’            )}
   241â†’
   242â†’            <div className="mt-6 flex justify-center">
   243â†’              <button
   244â†’                onClick={getRecommendations}
   245â†’                disabled={loading}
   246â†’                className="px-8 py-3 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 transition disabled:opacity-50"
   247â†’              >
   248â†’                {loading ? (
   249â†’                  <span className="flex items-center space-x-2">
   250â†’                    <svg
   251â†’                      className="animate-spin h-5 w-5"
   252â†’                      fill="none"
   253â†’                      viewBox="0 0 24 24"
   254â†’                    >
   255â†’                      <circle
   256â†’                        className="opacity-25"
   257â†’                        cx="12"
   258â†’                        cy="12"
   259â†’                        r="10"
   260â†’                        stroke="currentColor"
   261â†’                        strokeWidth="4"
   262â†’                      />
   263â†’                      <path
   264â†’                        className="opacity-75"
   265â†’                        fill="currentColor"
   266â†’                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
   267â†’                      />
   268â†’                    </svg>
   269â†’                    <span>Finding Rackets...</span>
   270â†’                  </span>
   271â†’                ) : (
   272â†’                  'Get Recommendations'
   273â†’                )}
   274â†’              </button>
   275â†’            </div>
   276â†’          </div>
   277â†’
   278â†’          {/* Recommendations Grid */}
   279â†’          {recommendations.length > 0 && (
   280â†’            <div>
   281â†’              <h2 className="text-xl font-bold text-gray-900 mb-4">
   282â†’                Top 5 Recommended Rackets
   283â†’              </h2>
   284â†’              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
   285â†’                {recommendations.map((racket, index) => (
   286â†’                  <div
   287â†’                    key={racket.id}
   288â†’                    className="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition"
   289â†’                  >
   290â†’                    {/* Rank Badge */}
   291â†’                    <div className="relative">
   292â†’                      <div className="bg-gray-100 h-48 flex items-center justify-center">
   293â†’                        <span className="text-6xl">ğŸ¸</span>
   294â†’                      </div>
   295â†’                      <div className="absolute top-3 left-3 w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center">
   296â†’                        <span className="text-white font-bold text-sm">
   297â†’                          #{index + 1}
   298â†’                        </span>
   299â†’                      </div>
   300â†’                      <button
   301â†’                        onClick={() => toggleFavorite(racket.id)}
   302â†’                        className="absolute top-3 right-3 w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm hover:shadow-md transition"
   303â†’                      >
   304â†’                        <svg
   305â†’                          className={`w-5 h-5 ${
   306â†’                            favorites.has(racket.id)
   307â†’                              ? 'text-red-500 fill-current'
   308â†’                              : 'text-gray-400'
   309â†’                          }`}
   310â†’                          fill={favorites.has(racket.id) ? 'currentColor' : 'none'}
   311â†’                          stroke="currentColor"
   312â†’                          viewBox="0 0 24 24"
   313â†’                        >
   314â†’                          <path
   315â†’                            strokeLinecap="round"
   316â†’                            strokeLinejoin="round"
   317â†’                            strokeWidth={2}
   318â†’                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
   319â†’                          />
   320â†’                        </svg>
   321â†’                      </button>
   322â†’                    </div>
   323â†’
   324â†’                    <div className="p-4">
   325â†’                      {/* Header */}
   326â†’                      <div className="flex items-start justify-between mb-2">
   327â†’                        <div>
   328â†’                          <h3 className="font-semibold text-gray-900">
   329â†’                            {racket.name}
   330â†’                          </h3>
   331â†’                          <p className="text-sm text-gray-500">{racket.brand}</p>
   332â†’                        </div>
   333â†’                        <div className="text-right">
   334â†’                          <p className="font-bold text-primary-600">
   335â†’                            {racket.match_score}%
   336â†’                          </p>
   337â†’                          <p className="text-xs text-gray-500">match</p>
   338â†’                        </div>
   339â†’                      </div>
   340â†’
   341â†’                      {/* Match Reason */}
   342â†’                      <p className="text-sm text-gray-600 mb-3">
   343â†’                        {racket.match_reason}
   344â†’                      </p>
   345â†’
   346â†’                      {/* Specs */}
   347â†’                      <div className="grid grid-cols-2 gap-2 text-xs mb-3">
   348â†’                        <div className="bg-gray-50 rounded p-2">
   349â†’                          <p className="text-gray-500">Weight</p>
   350â†’                          <p className="font-medium text-gray-900">
   351â†’                            {racket.weight}
   352â†’                          </p>
   353â†’                        </div>
   354â†’                        <div className="bg-gray-50 rounded p-2">
   355â†’                          <p className="text-gray-500">Balance</p>
   356â†’                          <p className="font-medium text-gray-900">
   357â†’                            {racket.balance}
   358â†’                          </p>
   359â†’                        </div>
   360â†’                        <div className="bg-gray-50 rounded p-2">
   361â†’                          <p className="text-gray-500">Flex</p>
   362â†’                          <p className="font-medium text-gray-900">
   363â†’                            {racket.flexibility}
   364â†’                          </p>
   365â†’                        </div>
   366â†’                        <div className="bg-gray-50 rounded p-2">
   367â†’                          <p className="text-gray-500">Price</p>
   368â†’                          <p className="font-medium text-gray-900">
   369â†’                            {racket.price_range}
   370â†’                          </p>
   371â†’                        </div>
   372â†’                      </div>
   373â†’
   374â†’                      {/* Style Tags */}
   375â†’                      <div className="flex flex-wrap gap-1 mb-4">
   376â†’                        {racket.play_style.map((style) => (
   377â†’                          <span
   378â†’                            key={style}
   379â†’                            className="px-2 py-1 bg-primary-50 text-primary-700 rounded text-xs"
   380â†’                          >
   381â†’                            {style}
   382â†’                          </span>
   383â†’                        ))}
   384â†’                      </div>
   385â†’
   386â†’                      {/* Action Button */}
   387â†’                      <button
   388â†’                        onClick={() => openEbaySearch(racket.ebay_search_query)}
   389â†’                        className="w-full py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition flex items-center justify-center space-x-2"
   390â†’                      >
   391â†’                        <span>View on eBay</span>
   392â†’                        <svg
   393â†’                          className="w-4 h-4"
   394â†’                          fill="none"
   395â†’                          stroke="currentColor"
   396â†’                          viewBox="0 0 24 24"
   397â†’                        >
   398â†’                          <path
   399â†’                            strokeLinecap="round"
   400â†’                            strokeLinejoin="round"
   401â†’                            strokeWidth={2}
   402â†’                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
   403â†’                          />
   404â†’                        </svg>
   405â†’                      </button>
   406â†’                    </div>
   407â†’                  </div>
   408â†’                ))}
   409â†’              </div>
   410â†’            </div>
   411â†’          )}
   412â†’
   413â†’          {/* Empty State */}
   414â†’          {recommendations.length === 0 && !loading && (
   415â†’            <div className="text-center py-12">
   416â†’              <div className="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
   417â†’                <span className="text-4xl">ğŸ¸</span>
   418â†’              </div>
   419â†’              <h3 className="text-lg font-medium text-gray-900 mb-2">
   420â†’                Find Your Perfect Racket
   421â†’              </h3>
   422â†’              <p className="text-gray-500 max-w-md mx-auto">
   423â†’                Select your skill level, playing style, and areas you want to
   424â†’                improve, then click &quot;Get Recommendations&quot; to see personalized
   425â†’                racket suggestions.
   426â†’              </p>
   427â†’            </div>
   428â†’          )}
   429â†’        </div>
   430â†’      </main>
   431â†’    </div>
   432â†’  );
   433â†’}
   434â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
